---
import '../styles/global.css';
import { getCurrentLocale, type Locale } from '../i18n/config';
import { SiteNav } from '../components/SiteNav';
import { getSiteNavData } from '../lib/wordpress/api';

interface Props {
  title?: string;
  description?: string;
  lang?: Locale;
}

const { 
  title = 'Qualitour - Premium China Tours',
  description = 'Experience unforgettable journeys through China with our expertly crafted tours.',
  lang
} = Astro.props;

// Get current locale from URL or use provided lang
const currentLocale = lang || getCurrentLocale(Astro.url);
const htmlLang = currentLocale === 'zh' ? 'zh-CN' : 'en';

// Fetch navigation data at build time
let navData = { activities: [], destinations: [], durations: [], types: [] };
try {
  navData = await getSiteNavData(currentLocale);
} catch (e) {
  console.error('Failed to fetch nav data:', e);
}
---

<!DOCTYPE html>
<html lang={htmlLang}>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content={description} />
  
  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  
  <!-- SEO -->
  <title>{title}</title>
  <meta name="robots" content="index, follow" />
  
  <!-- Open Graph -->
  <meta property="og:title" content={title} />
  <meta property="og:description" content={description} />
  <meta property="og:type" content="website" />
  
  <!-- Fonts - Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Kaushan+Script&display=swap" rel="stylesheet" />
  
  <!-- Material Icons -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
</head>
<body class="min-h-screen bg-white text-gray-900 antialiased">
  <!-- Navigation -->
  <SiteNav 
    lang={currentLocale}
    destinations={navData.destinations}
    activities={navData.activities}
    types={navData.types}
    client:load
  />

  <!-- Main Content -->
  <main>
    <slot />
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-gray-400">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <!-- Top Section -->
      <div class="py-12 grid grid-cols-1 md:grid-cols-4 gap-8">
        <!-- Brand -->
        <div class="md:col-span-1">
          <a href={currentLocale === 'en' ? '/' : `/${currentLocale}/`} class="block">
            <img src="/logo.svg" alt="Qualitour" class="h-12 w-auto brightness-0 invert opacity-80 hover:opacity-100 transition-opacity" />
          </a>
          <p class="mt-4 text-sm">
            Premium guided tours crafted for unforgettable experiences across China and beyond.
          </p>
        </div>

        <!-- Quick Links -->
        <div>
          <h4 class="text-white font-semibold mb-4">Quick Links</h4>
          <ul class="space-y-2 text-sm">
            <li><a href="/tours" class="hover:text-white transition-colors">All Tours</a></li>
            <li><a href="/tours/featured" class="hover:text-white transition-colors">Featured Tours</a></li>
            <li><a href="/about-us" class="hover:text-white transition-colors">About Us</a></li>
            <li><a href="/contact" class="hover:text-white transition-colors">Contact</a></li>
          </ul>
        </div>

        <!-- Services -->
        <div>
          <h4 class="text-white font-semibold mb-4">Services</h4>
          <ul class="space-y-2 text-sm">
            <li><a href="/private-transfers" class="hover:text-white transition-colors">Private Transfers</a></li>
            <li><a href="/visa" class="hover:text-white transition-colors">China Visa</a></li>
            <li><a href="/faq" class="hover:text-white transition-colors">FAQ</a></li>
            <li><a href="/reviews" class="hover:text-white transition-colors">Reviews</a></li>
          </ul>
        </div>

        <!-- Contact -->
        <div>
          <h4 class="text-white font-semibold mb-4">Contact Us</h4>
          <ul class="space-y-3 text-sm">
            <li class="flex items-start gap-3">
              <span class="material-icons text-orange-400 text-lg">email</span>
              <a href="mailto:info@qualitour.com" class="hover:text-white transition-colors">info@qualitour.com</a>
            </li>
            <li class="flex items-start gap-3">
              <span class="material-icons text-orange-400 text-lg">phone</span>
              <a href="tel:+1234567890" class="hover:text-white transition-colors">+1 (234) 567-890</a>
            </li>
            <li class="flex items-start gap-3">
              <span class="material-icons text-orange-400 text-lg">location_on</span>
              <span>Vancouver, BC, Canada</span>
            </li>
          </ul>
        </div>
      </div>

      <!-- Bottom Section -->
      <div class="border-t border-gray-800 py-6 flex flex-col md:flex-row items-center justify-between gap-4">
        <p class="text-sm">
          &copy; {new Date().getFullYear()} Qualitour. All rights reserved.
        </p>
        <div class="flex items-center gap-6 text-sm">
          <a href="/privacy-policy" class="hover:text-white transition-colors">Privacy Policy</a>
          <a href="/terms" class="hover:text-white transition-colors">Terms of Service</a>
        </div>
      </div>
    </div>
  </footer>
</body>
</html>

<style is:global>
  :root {
    --font-inter: 'Inter', system-ui, sans-serif;
    --font-kaushan-script: 'Kaushan Script', cursive;
  }

  body {
    font-family: var(--font-inter);
  }

  .font-kaushan {
    font-family: var(--font-kaushan-script);
  }
</style>
